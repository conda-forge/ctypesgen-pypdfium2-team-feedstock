From 069d589653bb82bdbe24423a03dbf0b15cc75743 Mon Sep 17 00:00:00 2001
From: Jan Janssen <jan-janssen@users.noreply.github.com>
Date: Thu, 11 Jul 2024 17:12:37 +0200
Subject: [PATCH] Patch gcc

---
 src/ctypesgen/__main__.py | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/ctypesgen/__main__.py b/src/ctypesgen/__main__.py
index d2c8c20..a4d6b7b 100644
--- a/src/ctypesgen/__main__.py
+++ b/src/ctypesgen/__main__.py
@@ -1,3 +1,4 @@
+import os
 import re
 import sys
 import shlex
@@ -90,6 +91,8 @@ def main_impl(args, cmd_str):
     if args.cpp:
         assert shutil.which(args.cpp[0]), f"Given pre-processor {args.cpp[0]!r} is not available."
     else:
+        if "CC" in os.environ:
+            args.cpp = [os.environ["CC"], "-E"]
         if shutil.which("gcc"):
             args.cpp = ["gcc", "-E"]
         elif shutil.which("cpp"):
