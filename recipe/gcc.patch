From df4d9ebeeeee8dc236531fca5d614cd1b1465a3a Mon Sep 17 00:00:00 2001
From: Jan Janssen <jan-janssen@users.noreply.github.com>
Date: Thu, 11 Jul 2024 14:14:47 +0200
Subject: [PATCH] Update ctypesgentest.py

---
 ctypesgen/options.py   | 3 ++-
 tests/ctypesgentest.py | 6 +++---
 2 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/tests/ctypesgentest.py b/tests/ctypesgentest.py
index a567e2b4..efd21350 100644
--- a/tests/ctypesgentest.py
+++ b/tests/ctypesgentest.py
@@ -206,11 +206,11 @@ def cleanup_common():
 
 
 def _compile_common(common_lib):
-    subprocess.run(["gcc", "-c", f"{COMMON_DIR}/a.c", "-o", f"{COMMON_DIR}/a.o"])
-    subprocess.run(["gcc", "-c", f"{COMMON_DIR}/b.c", "-o", f"{COMMON_DIR}/b.o"])
+    subprocess.run([os.environ["CC"], "-c", f"{COMMON_DIR}/a.c", "-o", f"{COMMON_DIR}/a.o"])
+    subprocess.run([os.environ["CC"], "-c", f"{COMMON_DIR}/b.c", "-o", f"{COMMON_DIR}/b.o"])
     subprocess.run(
         [
-            "gcc",
+            os.environ["CC"],
             "-shared",
             "-o",
             f"{COMMON_DIR}/{common_lib}",
diff --git a/ctypesgen/options.py b/ctypesgen/options.py
index 2afe53e0..35482a73 100755
--- a/ctypesgen/options.py
+++ b/ctypesgen/options.py
@@ -7,6 +7,7 @@
 """
 
 import optparse
+import os
 import copy
 
 default_values = {
@@ -15,7 +16,7 @@
     "include_search_paths": [],
     "compile_libdirs": [],
     "runtime_libdirs": [],
-    "cpp": "gcc -E",
+    "cpp": os.environ["CC"] + " -E",
     "allow_gnu_c": False,
     "cpp_defines": [],
     "cpp_undefines": [],
